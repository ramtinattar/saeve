{%- assign product = all_products[section.blocks[0].settings.product] -%}

{%- capture section_settings -%}
{
  "enableHistoryState": false,
  "usePlaceholder": {% if product == empty %}true{% else %}false{% endif %},
  "showInventoryQuantity": {% if section.settings.show_inventory_quantity %}true{% else %}false{% endif %},
  "inventoryQuantityThreshold": {{ section.settings.inventory_quantity_threshold }},
  "showPaymentButton": {{ section.settings.show_payment_button | json }},
  "useAjaxCart": {% if settings.cart_type == 'drawer' %}true{% else %}false{% endif %}
}
{%- endcapture -%}

<section class="Section Section--spacingNormal" data-section-id="{{ section.id }}" data-section-type="featured-product" data-section-settings='{{ section_settings }}'>
  <div class="Container">
    {%- if section.settings.background_1 != blank -%}
      <img class="Image--lazyLoad Image--zoomOut background-pic1" data-src="{{ section.settings.background_1 | img_url: '600x' }}" data-expand="-200" data-widths="[{{ supported_sizes }}]" data-sizes="auto" alt="background">
    {%- endif -%}
    {%- if section.settings.background_2 != blank -%}
      <img class="Image--lazyLoad Image--zoomOut background-pic2" data-src="{{ section.settings.background_2 | img_url: '200x' }}" data-expand="-200" data-widths="[{{ supported_sizes }}]" data-sizes="auto" alt="background">
    {%- endif -%}
    {%- if section.settings.background_3 != blank -%}
      <img class="Image--lazyLoad Image--zoomOut background-pic3" data-src="{{ section.settings.background_3 | img_url: '400x' }}" data-expand="-200" data-widths="[{{ supported_sizes }}]" data-sizes="auto" alt="background">
    {%- endif -%}
    {%- if section.settings.background_4 != blank -%}
      <img class="Image--lazyLoad Image--zoomOut background-pic4" data-src="{{ section.settings.background_4 | img_url: '400x' }}" data-expand="-200" data-widths="[{{ supported_sizes }}]" data-sizes="auto" alt="background">
    {%- endif -%}
    {%- if section.settings.subheading != blank or section.settings.title != blank -%}
      <header class="SectionHeader SectionHeader--center {% unless section.settings.show_headings_on_mobile %}hidden-phone{% endunless %}">
        {%- if section.settings.subheading != blank -%}
        <img src="https://cdn.shopify.com/s/files/1/0049/9908/6193/files/mini-logo-product.png?v=1547475066" alt="logo" width="117" height="31">
          <h2 class="SectionHeader__SubHeading Heading u-h6">{{ section.settings.subheading | escape }}</h3>
        {%- endif -%}

      </header>
    {%- endif -%}
	<div class="Carousel main-carousel">
      {% for prod in section.blocks %}
      {% assign product = all_products[prod.settings.product] %}
      <div class="FeaturedProduct {% if section.settings.show_description == false or product.description == blank %}FeaturedProduct--center {% endif %}{% if prod.settings.img-align == 'droite'%} featured-product-img--right{% endif %} ">
        <img class="bg-pic" src="{{ prod.settings.background-img | img_url: 'master' }}"  alt="{{prod.settings.background-img.alt}}">
        {%- if product != empty -%}
          {%- comment -%}
          --------------------------------------------------------------------------------------------------------------------
          PRODUCT GALLERY
          --------------------------------------------------------------------------------------------------------------------
          {%- endcomment -%}

          {%- if product.images.size > 0 -%}
            <a href="{{ product.url }}" class="FeaturedProduct__Gallery">
              {%- include 'image-size', sizes: '200,300,400,600,700,800,900,1000', image: product.featured_image -%}

              <div class="AspectRatio" style="max-width: {{ product.featured_image.width }}px; --aspect-ratio: {{ product.featured_image.aspect_ratio }}">
                {% assign image_url = product.featured_image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' %}

                <img class="Image--lazyLoad Image--fadeIn featured-product_image" data-src="{{ image_url }}" data-widths="[{{ supported_sizes }}]" data-sizes="auto" alt="{{ product.featured_image.alt | escape }}">
                <span class="Image__Loader"></span>

                <noscript>
                  <img src="{{ product.featured_image | img_url: '600x' }}" alt="{{ product.featured_image.alt | escape }}">
                </noscript>
              </div>
            </a>
          {%- endif -%}

          <div class="FeaturedProduct__Info">
             <div class="container-FeaturedProduct__Info">
            {%- include 'product-meta', show_description: section.settings.show_description -%}
            {%- include 'product-form' -%}

            {%- if section.settings.show_description and section.settings.description_below_add_to_cart -%}
              <div class="ProductMeta__Description Rte">
                {{ product.description }}
              </div>
            {%- endif -%}

            <div class="FeaturedProduct__ViewWrapper">
              <a href="{{ product.url }}" class="Link Link--underline">{{ 'home_page.featured_product.view_product' | t }}</a>
            </div>
            </div>
          </div>
        {%- else -%}
          {%- comment -%}
          --------------------------------------------------------------------------------------------------------------------
          PLACEHOLDER WHEN NO PRODUCT IS SELECTED
          --------------------------------------------------------------------------------------------------------------------
          {%- endcomment -%}

          <div class="FeaturedProduct__Gallery">
            {{- 'product-1' | placeholder_svg_tag -}}
          </div>

          <div class="FeaturedProduct__Info">
            <div class="ProductMeta">
              {%- if section.settings.show_vendor -%}
                <span class="ProductMeta__Vendor Heading u-h6">{{ 'home_page.onboarding.vendor_title' | t }}</span>
              {%- endif -%}

              <h3 class="ProductMeta__Title Heading u-h2">{{ 'home_page.onboarding.product_title' | t }}</h3>

              <div class="ProductMeta__PriceList Heading">
                <span class="ProductMeta__Price Price Text--subdued u-h4" data-money-convertible>{{ 4500 | money_without_trailing_zeros }}</span>
              </div>

              {%- if section.settings.show_description and section.settings.show_description_after_add_to_cart == false -%}
                <div class="ProductMeta__Description Rte">
                  {{ 'home_page.onboarding.product_description' | t }}
                </div>
              {%- endif -%}
            </div>

            <div class="ProductForm">
              {%- if section.settings.show_inventory_quantity -%}
                <p class="ProductForm__Inventory Text--subdued">
                  {%- if section.settings.inventory_quantity_threshold == 0 -%}
                    {{- 'product.form.inventory_quantity_count' | t: count: 5 -}}
                  {%- else -%}
                    {{- 'product.form.low_inventory_quantity_count' | t: count: section.settings.inventory_quantity_threshold -}}
                  {%- endif -%}
                </p>
              {%- endif -%}

              <button type="button" class="ProductForm__AddToCart Button Button--primary Button--full">
                <span class="Button__PrimaryState">
                    <span>{{ 'product.form.add_to_cart' | t }}</span>
                    <span class="Button__SeparatorDot"></span>
                    <span data-money-convertible>{{ 4500 | money_without_trailing_zeros }}</span>
                </span>
              </button>
            </div>

            {%- if section.settings.show_description and section.settings.show_description_after_add_to_cart -%}
              <div class="ProductMeta__Description Rte">
                {{ 'home_page.onboarding.product_description' | t }}
              </div>
            {%- endif -%}

            <div class="FeaturedProduct__ViewWrapper">
              <a href="#" class="Link Link--underline">{{ 'home_page.featured_product.view_product' | t }}</a>
            </div>
          </div>
        {%- endif -%}
      </div>
      {% endfor %}

<!-- **BEGIN** Hextom USB Integration // Home Featured Product Include - DO NOT MODIFY -->
    {% render 'hextom_usb_home_featured_prod', product: product %}
    <!-- **END** Hextom USB Integration // Home Featured Product Include - DO NOT MODIFY -->
</div>
  {%- comment -%}
  --------------------------------------------------------------------------------------------------------------------
  OFF SCREEN ELEMENTS
  --------------------------------------------------------------------------------------------------------------------
  {%- endcomment -%}

  {{- product_popovers -}}
  {{- product_modals -}}
</section>

{% schema %}
{
  "name": "Featured product",
  "class": "shopify-section--bordered",
  "settings": [
    {
      "type": "text",
      "id": "subheading",
      "label": "Sub-heading"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Featured product"
    },
    {
      "type": "checkbox",
      "id": "show_headings_on_mobile",
      "label": "Show headings on mobile",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show description",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "description_below_add_to_cart",
      "label": "Description below add to cart",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_color_swatch",
      "label": "Show colors",
      "info": "Some colors appear white? [Learn more](http://support.maestrooo.com/article/80-product-uploading-custom-color-for-color-swatch).",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_color_carousel",
      "label": "Show color carousel",
      "info": "A selector will appear with variant image previews when choosing colors.",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_quantity_selector",
      "label": "Show quantity selector",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_inventory_quantity",
      "label": "Show inventory quantity",
      "info": "Make sure that your inventory is tracked. [Learn more](https://help.shopify.com/manual/products/inventory#set-up-inventory-tracking).",
      "default": false
    },
    {
      "type": "range",
      "id": "inventory_quantity_threshold",
      "label": "Inventory quantity threshold",
      "min": 0,
      "max": 50,
      "step": 1,
      "info": "Only show inventory quantity if below threshold. Choose 0 to always show.",
      "default": 0
    },
    {
      "type": "checkbox",
      "id": "show_payment_button",
      "label": "Show dynamic checkout button",
      "info": "Lets customers check out directly using a familiar payment method. [Learn more](https://help.shopify.com/manual/using-themes/change-the-layout/dynamic-checkout)",
      "default": false
    },
    {
      "type": "image_picker",
      "id": "background_1",
      "label": "background_1"
    },
    {
      "type": "image_picker",
      "id": "background_2",
      "label": "background_2"
    },
    {
      "type": "image_picker",
      "id": "background_3",
      "label": "background_3"
    },
    {
      "type": "image_picker",
      "id": "background_4",
      "label": "background_4"
    }
  ],
  "blocks": [
    {
      "type": "text",
      "name": "products",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "image_picker",
           "id": "background-img",
           "label": "Image de fond"
        },
		{
		  "type": "select",
          "id": "img-align",
          "label": "Position de l'image",
          "options": [
            {
              "value": "gauche",
              "label": "Gauche"
            },
            {
              "value": "droite",
              "label": "Droite"
            }
          ],
          "default": "gauche"
        }
      ]
    }
  ],
  "presets": [
    {
      "category": "Product",
      "name": "Featured product"
    }
  ]
}
{% endschema %}
